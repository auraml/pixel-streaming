"use strict";function _interopDefault(ex){return ex&&"object"==typeof ex&&"default"in ex?ex.default:ex}Object.defineProperty(exports,"__esModule",{value:!0});var React=require("react"),React__default=_interopDefault(React),semver=_interopDefault(require("semver")),rsuite=require("rsuite"),moment=_interopDefault(require("moment")),uuid=_interopDefault(require("short-uuid")),reactJsonTree=require("react-json-tree"),reactJss=require("react-jss"),metaeditor4Ue=require("metaeditor4-ue"),metaeditor4Ui=require("metaeditor4-ui"),SpinnerIcon=_interopDefault(require("@rsuite/icons/legacy/Spinner")),PlayOutlineIcon=_interopDefault(require("@rsuite/icons/PlayOutline")),reactPortal=require("react-portal"),useResizeObserver=_interopDefault(require("use-resize-observer")),CheckRoundIcon=_interopDefault(require("@rsuite/icons/CheckRound")),ToolsIcon=_interopDefault(require("@rsuite/icons/Tools"));function _regeneratorRuntime(){_regeneratorRuntime=function(){return exports};var exports={},Op=Object.prototype,hasOwn=Op.hasOwnProperty,defineProperty=Object.defineProperty||function(obj,key,desc){obj[key]=desc.value},$Symbol="function"==typeof Symbol?Symbol:{},iteratorSymbol=$Symbol.iterator||"@@iterator",asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator",toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";function define(obj,key,value){return Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}),obj[key]}try{define({},"")}catch(err){define=function(obj,key,value){return obj[key]=value}}function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator,generator=Object.create(protoGenerator.prototype),context=new Context(tryLocsList||[]);return defineProperty(generator,"_invoke",{value:makeInvokeMethod(innerFn,self,context)}),generator}function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}exports.wrap=wrap;var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var IteratorPrototype={};define(IteratorPrototype,iteratorSymbol,(function(){return this}));var getProto=Object.getPrototypeOf,NativeIteratorPrototype=getProto&&getProto(getProto(values([])));NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)&&(IteratorPrototype=NativeIteratorPrototype);var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);function defineIteratorMethods(prototype){["next","throw","return"].forEach((function(method){define(prototype,method,(function(arg){return this._invoke(method,arg)}))}))}function AsyncIterator(generator,PromiseImpl){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if("throw"!==record.type){var result=record.arg,value=result.value;return value&&"object"==typeof value&&hasOwn.call(value,"__await")?PromiseImpl.resolve(value.__await).then((function(value){invoke("next",value,resolve,reject)}),(function(err){invoke("throw",err,resolve,reject)})):PromiseImpl.resolve(value).then((function(unwrapped){result.value=unwrapped,resolve(result)}),(function(error){return invoke("throw",error,resolve,reject)}))}reject(record.arg)}var previousPromise;defineProperty(this,"_invoke",{value:function(method,arg){function callInvokeWithMethodAndArg(){return new PromiseImpl((function(resolve,reject){invoke(method,arg,resolve,reject)}))}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(innerFn,self,context){var state="suspendedStart";return function(method,arg){if("executing"===state)throw new Error("Generator is already running");if("completed"===state){if("throw"===method)throw arg;return doneResult()}for(context.method=method,context.arg=arg;;){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult}}if("next"===context.method)context.sent=context._sent=context.arg;else if("throw"===context.method){if("suspendedStart"===state)throw state="completed",context.arg;context.dispatchException(context.arg)}else"return"===context.method&&context.abrupt("return",context.arg);state="executing";var record=tryCatch(innerFn,self,context);if("normal"===record.type){if(state=context.done?"completed":"suspendedYield",record.arg===ContinueSentinel)continue;return{value:record.arg,done:context.done}}"throw"===record.type&&(state="completed",context.method="throw",context.arg=record.arg)}}}function maybeInvokeDelegate(delegate,context){var methodName=context.method,method=delegate.iterator[methodName];if(void 0===method)return context.delegate=null,"throw"===methodName&&delegate.iterator.return&&(context.method="return",context.arg=void 0,maybeInvokeDelegate(delegate,context),"throw"===context.method)||"return"!==methodName&&(context.method="throw",context.arg=new TypeError("The iterator does not provide a '"+methodName+"' method")),ContinueSentinel;var record=tryCatch(method,delegate.iterator,context.arg);if("throw"===record.type)return context.method="throw",context.arg=record.arg,context.delegate=null,ContinueSentinel;var info=record.arg;return info?info.done?(context[delegate.resultName]=info.value,context.next=delegate.nextLoc,"return"!==context.method&&(context.method="next",context.arg=void 0),context.delegate=null,ContinueSentinel):info:(context.method="throw",context.arg=new TypeError("iterator result is not an object"),context.delegate=null,ContinueSentinel)}function pushTryEntry(locs){var entry={tryLoc:locs[0]};1 in locs&&(entry.catchLoc=locs[1]),2 in locs&&(entry.finallyLoc=locs[2],entry.afterLoc=locs[3]),this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal",delete record.arg,entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}],tryLocsList.forEach(pushTryEntry,this),this.reset(!0)}function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod)return iteratorMethod.call(iterable);if("function"==typeof iterable.next)return iterable;if(!isNaN(iterable.length)){var i=-1,next=function next(){for(;++i<iterable.length;)if(hasOwn.call(iterable,i))return next.value=iterable[i],next.done=!1,next;return next.value=void 0,next.done=!0,next};return next.next=next}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,defineProperty(Gp,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),defineProperty(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,toStringTagSymbol,"GeneratorFunction"),exports.isGeneratorFunction=function(genFun){var ctor="function"==typeof genFun&&genFun.constructor;return!!ctor&&(ctor===GeneratorFunction||"GeneratorFunction"===(ctor.displayName||ctor.name))},exports.mark=function(genFun){return Object.setPrototypeOf?Object.setPrototypeOf(genFun,GeneratorFunctionPrototype):(genFun.__proto__=GeneratorFunctionPrototype,define(genFun,toStringTagSymbol,"GeneratorFunction")),genFun.prototype=Object.create(Gp),genFun},exports.awrap=function(arg){return{__await:arg}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,asyncIteratorSymbol,(function(){return this})),exports.AsyncIterator=AsyncIterator,exports.async=function(innerFn,outerFn,self,tryLocsList,PromiseImpl){void 0===PromiseImpl&&(PromiseImpl=Promise);var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList),PromiseImpl);return exports.isGeneratorFunction(outerFn)?iter:iter.next().then((function(result){return result.done?result.value:iter.next()}))},defineIteratorMethods(Gp),define(Gp,toStringTagSymbol,"Generator"),define(Gp,iteratorSymbol,(function(){return this})),define(Gp,"toString",(function(){return"[object Generator]"})),exports.keys=function(val){var object=Object(val),keys=[];for(var key in object)keys.push(key);return keys.reverse(),function next(){for(;keys.length;){var key=keys.pop();if(key in object)return next.value=key,next.done=!1,next}return next.done=!0,next}},exports.values=values,Context.prototype={constructor:Context,reset:function(skipTempReset){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!skipTempReset)for(var name in this)"t"===name.charAt(0)&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))&&(this[name]=void 0)},stop:function(){this.done=!0;var rootRecord=this.tryEntries[0].completion;if("throw"===rootRecord.type)throw rootRecord.arg;return this.rval},dispatchException:function(exception){if(this.done)throw exception;var context=this;function handle(loc,caught){return record.type="throw",record.arg=exception,context.next=loc,caught&&(context.method="next",context.arg=void 0),!!caught}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i],record=entry.completion;if("root"===entry.tryLoc)return handle("end");if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc"),hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0)}else{if(!hasFinally)throw new Error("try statement without catch or finally");if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}}}},abrupt:function(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}finallyEntry&&("break"===type||"continue"===type)&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc&&(finallyEntry=null);var record=finallyEntry?finallyEntry.completion:{};return record.type=type,record.arg=arg,finallyEntry?(this.method="next",this.next=finallyEntry.finallyLoc,ContinueSentinel):this.complete(record)},complete:function(record,afterLoc){if("throw"===record.type)throw record.arg;return"break"===record.type||"continue"===record.type?this.next=record.arg:"return"===record.type?(this.rval=this.arg=record.arg,this.method="return",this.next="end"):"normal"===record.type&&afterLoc&&(this.next=afterLoc),ContinueSentinel},finish:function(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc)return this.complete(entry.completion,entry.afterLoc),resetTryEntry(entry),ContinueSentinel}},catch:function(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if("throw"===record.type){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function(iterable,resultName,nextLoc){return this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc},"next"===this.method&&(this.arg=void 0),ContinueSentinel}},exports}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}function _objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var target={},sourceKeys=Object.keys(source),key,i;for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],excluded.indexOf(key)>=0||(target[key]=source[key]);return target}function _toPrimitive(input,hint){if("object"!=typeof input||null===input)return input;var prim=input[Symbol.toPrimitive];if(void 0!==prim){var res=prim.call(input,hint||"default");if("object"!=typeof res)return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===hint?String:Number)(input)}function _toPropertyKey(arg){var key=_toPrimitive(arg,"string");return"symbol"==typeof key?key:String(key)}var KEYS={UPDATE:"UPDATE"};function Reducer(state,action){var type=action.type,anValue=action.payload;return type===KEYS.UPDATE?_extends({},state,anValue):state}var initialState={packageVersion:{latest:null,current:null,needUpdate:!1},showPreloader:!0,licenseData:null},name="pixel-streaming",names=["pixel-streaming","unreal-engine","react-pixel-streaming","unreal-engine-pixel-streaming","metaeditor","metaverses","unrealos","react-unreal-engine"],version="4.2.50",author="Unrealos",license="MIT",description="The Pixel Streaming library for ReactJS facilitates the integration of Unreal Engine v.5 into a web browser. It enables the transmission of commands and receipt of callbacks from the stream server once Unreal Engine is launched.",homepage="https://metaeditor.io",repository={type:"git",url:"git+https://github.com/markolofsen/metaeditor.git"},bugs={url:"https://github.com/markolofsen/metaeditor/issues"},keywords=["reactjs","node","typescript","pixel streaming","unreal engine","epic games","metaverse","metaeditor","unrealos"],main="dist/index.js",typings="dist/index.d.ts",files=["dist"],engines={node:">=v16"},scripts={"copy-files":"copyfiles -u 1 src/styles/*.css dist/",dev:"tsdx watch NODE_ENV=development",start:"tsdx watch",build:"tsdx build --transpileOnly && pnpm copy-files",test:"tsdx test",lint:"tsdx lint",prepare:"tsdx build",symlink:"npm link ../library ../ui-library","build-all":"yarn symlink && cd ../library && npm run build && cd ../ui-library && npm run build-all"},husky={hooks:{"pre-commit":"tsdx lint"}},prettier={printWidth:80,semi:!1,singleQuote:!1,trailingComma:"es5"},module$1="dist/index.esm.js",peerDependencies={react:"^18.1.0",rsuite:"^5.28.1"},dependencies={"metaeditor4-ue":"^0.3.0","metaeditor4-ui":"^0.2.0",moment:"^2.29.4","react-json-tree":"^0.18.0","react-jss":"^10.10.0","react-portal":"^4.2.2",semver:"^7.3.8","short-uuid":"^4.2.2","use-resize-observer":"latest"},devDependencies={"@testing-library/jest-dom":"^5.16.4","@testing-library/react":"^13.2.0","@testing-library/user-event":"^13.5.0","@types/react-portal":"^4.0.4","@typescript-eslint/eslint-plugin":"^5.16.0","@typescript-eslint/parser":"^5.16.0",copyfiles:"^2.4.1",eslint:"^8.11.0",husky:"^7.0.2","react-scripts":"5.0.1",rsuite:"^5.28.1",tsdx:"^0.14.1",tslib:"^2.3.1",typescript:"^4.6.3"},pkg={name:name,names:names,version:version,author:author,license:license,description:description,public:!0,homepage:homepage,repository:repository,bugs:bugs,keywords:keywords,main:main,typings:typings,files:files,engines:engines,scripts:scripts,husky:husky,prettier:prettier,module:module$1,peerDependencies:peerDependencies,dependencies:dependencies,devDependencies:devDependencies},isDev=!0,apiHost="https://unrealos.com",project={isDev:isDev,apiHost:apiHost,name:"MetaEditor",package:{name:pkg.name,version:pkg.version,npmUrl:"https://www.npmjs.com/package/"+pkg.name},license:{excludes:["localhost","127.0.0.1","0.0.0.0","player.metaeditor.io"],checkUrl:apiHost+"/api/unrealos/license/check/"},urls:{main:"http://metaeditor.io/",docs:"https://metaeditor.io/docs",support:"https://unrealos.com/p/contacts/",buy:"https://unrealos.com/apps/metaeditor/",signalingServer:"https://github.com/markolofsen/metaeditor/releases/tag/signaling-server",onlinePlayer:"https://player.metaeditor.io"}};function checkPackageVersion(){return _checkPackageVersion.apply(this,arguments)}function _checkPackageVersion(){return(_checkPackageVersion=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var url,v;return _regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return url="https://registry.npmjs.org/"+project.package.name,_context.next=3,new Promise((function(resolve,reject){fetch(url).then((function(res){return res.json()})).then((function(res){try{var latest=res["dist-tags"].latest,current=project.package.version,needUpdate=semver.gt(latest,current);resolve({latest:latest,current:current,needUpdate:needUpdate})}catch(err){console.error("Can't parse npm data"),resolve(null)}})).catch((function(err){console.error("Can't check package version"),resolve(!1)}))}));case 3:return v=_context.sent,_context.abrupt("return",v);case 5:case"end":return _context.stop()}}),_callee)})))).apply(this,arguments)}function checkLicenseKey(){return _checkLicenseKey.apply(this,arguments)}function _checkLicenseKey(){return(_checkLicenseKey=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var url,v;return _regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return url=project.license.checkUrl,_context.next=3,new Promise((function(resolve,reject){var host=window.location.hostname;project.license.excludes.includes(host)?resolve({is_exclusion:!0,is_valid:!1}):fetch(url,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({host:host})}).then((function(res){return res.json()})).then((function(res){resolve({is_exclusion:!1,is_valid:res.is_valid})})).catch((function(err){console.error("Can't check license"),resolve({is_exclusion:!1,is_valid:!0})}))}));case 3:return v=_context.sent,_context.abrupt("return",v);case 5:case"end":return _context.stop()}}),_callee)})))).apply(this,arguments)}var actions=function actions(){var _React$useReducer=React.useReducer(Reducer,initialState),state=_React$useReducer[0],_dispatch=_React$useReducer[1],cls;return new(function(){function _class(){}var _proto=_class.prototype;return _proto.dispatch=function dispatch(payload){_dispatch({type:KEYS.UPDATE,payload:payload})},_proto.checkVersion=function(){var _checkVersion=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){var packageVersion;return _regeneratorRuntime().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,checkPackageVersion();case 2:packageVersion=_context.sent,this.dispatch({packageVersion:packageVersion});case 4:case"end":return _context.stop()}}),_callee,this)})));function checkVersion(){return _checkVersion.apply(this,arguments)}return checkVersion}(),_proto.checkApiKey=function(){var _checkApiKey=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(){var licenseData;return _regeneratorRuntime().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,checkLicenseKey();case 2:licenseData=_context2.sent,this.dispatch({licenseData:licenseData});case 4:case"end":return _context2.stop()}}),_callee2,this)})));function checkApiKey(){return _checkApiKey.apply(this,arguments)}return checkApiKey}(),_proto.hidePreloader=function hidePreloader(){this.dispatch({showPreloader:!1})},_createClass(_class,[{key:"state",get:function get(){return state}},{key:"isLicenseValid",get:function get(){var _state$licenseData;return!!state.licenseData&&(null==(_state$licenseData=state.licenseData)?void 0:_state$licenseData.is_valid)}},{key:"isLicenseActivated",get:function get(){var _state$licenseData2,_state$licenseData3;return!!state.licenseData&&((null==(_state$licenseData2=state.licenseData)?void 0:_state$licenseData2.is_valid)||(null==(_state$licenseData3=state.licenseData)?void 0:_state$licenseData3.is_exclusion))}}]),_class}())},Context=React.createContext({}),useGlobalContext=function useGlobalContext(){return React.useContext(Context)},Provider=function Provider(props){var payload=actions();return React.createElement(Context.Provider,{value:payload},props.children)},KEYS$1={UPDATE:"UPDATE",UPDATE_PS_CONFIG_KEY:"UPDATE_PS_CONFIG_KEY"};function Reducer$1(state,action){var type=action.type,anValue=action.payload;return type===KEYS$1.UPDATE?_extends({},state,anValue):type===KEYS$1.UPDATE_PS_CONFIG_KEY?(state.playerConfig.psConfig=_extends({},state.playerConfig.psConfig,anValue),_extends({},state)):state}var initialState$1={playerConfig:null,webrtcStatus:null,webrtcMessage:!1,streamStatus:null,streamMessage:!1,freezeFrame:!1},actions$1=function actions(){var _React$useReducer=React.useReducer(Reducer$1,initialState$1),state=_React$useReducer[0],_dispatch=_React$useReducer[1],_React$useState=React.useState([]),commandsList=_React$useState[0],setCommandsList=_React$useState[1],_React$useState2=React.useState([]),responsesList=_React$useState2[0],setResponsesList=_React$useState2[1],refStreamApp=React.useRef(null),cls;return new(function(){function _class(){}var _proto=_class.prototype;return _proto.dispatch=function dispatch(payload){_dispatch({type:KEYS$1.UPDATE,payload:payload})},_proto.dispatchPsConfig=function dispatchPsConfig(payload){_dispatch({type:KEYS$1.UPDATE_PS_CONFIG_KEY,payload:payload})},_proto.setRefStream=function setRefStream(app){refStreamApp.current=app},_proto.setWebrtcStatus=function setWebrtcStatus(status,message){void 0===message&&(message=!1),this.dispatch({webrtcStatus:status,webrtcMessage:message})},_proto.setStreamStatus=function setStreamStatus(status,message){void 0===message&&(message=!1),this.dispatch({streamStatus:status,streamMessage:message})},_proto.setFreezeFrame=function setFreezeFrame(freezeFrame){this.dispatch({freezeFrame:freezeFrame})},_proto.addCommand=function addCommand(payload){setCommandsList((function(c){return[payload].concat(c).slice(0,100)}))},_proto.addResponse=function addResponse(payload){setResponsesList((function(c){return[payload].concat(c).slice(0,100)})),console.error("- ".repeat(30)),console.error("RESPONSE:",payload)},_proto.updateConfig=function updateConfig(playerConfig){this.dispatch({playerConfig:playerConfig})},_proto.setMuted=function setMuted(muted){this.dispatchPsConfig({startMuted:muted})},_createClass(_class,[{key:"state",get:function get(){return state}},{key:"commandsList",get:function get(){return commandsList}},{key:"responsesList",get:function get(){return responsesList}},{key:"streamApp",get:function get(){return refStreamApp.current}},{key:"isStreamActive",get:function get(){return"play"===state.streamStatus}},{key:"isWebrtcConnected",get:function get(){return"connected"===state.webrtcStatus}},{key:"isWebrtcError",get:function get(){return["failed","disconnected","disconnectedRestart"].includes(state.webrtcStatus)}},{key:"isStreamError",get:function get(){return["error","rejected"].includes(state.streamStatus)}}]),_class}())},Context$1=React.createContext({}),useStreamContext=function useStreamContext(){return React.useContext(Context$1)},Provider$1=function Provider(props){var payload=actions$1();return React.createElement(Context$1.Provider,{value:payload},props.children)};function ContextProvider(props){return React__default.createElement(Provider,null,React__default.createElement(Provider$1,null,props.children))}var JsonView=function JsonView(props){return React.createElement(reactJsonTree.JSONTree,{invertTheme:!1,shouldExpandNodeInitially:function shouldExpandNodeInitially(){return!!props.expanded},theme:{extend:theme,valueLabel:{}},data:props.data})},theme={scheme:"monokai",author:"wimer hazenberg (http://www.monokai.nl)",base00:"transparent",base01:"#383830",base02:"#49483e",base03:"#75715e",base04:"#a59f85",base05:"#f8f8f2",base06:"#f5f4f1",base07:"#f9f8f5",base08:"#f92672",base09:"#fd971f",base0A:"#f4bf75",base0B:"#a6e22e",base0C:"#a1efe4",base0D:"#66d9ef",base0E:"#ae81ff",base0F:"#cc6633"},watermarkTimer;function useSave(){var streamContext=useStreamContext(),toaster=rsuite.useToaster(),cls;return new(function(){function _class(){}var _proto;return _class.prototype.add=function add(type,payload,options){var newPayload={type:type,uuid:uuid.generate(),date:moment.utc().format(),payload:payload},showNotification,debugMode;streamContext.addCommand(newPayload),"off"!==(debugMode=streamContext.state.playerConfig.debugMode)&&!!["on","commands"].includes(debugMode)&&((null==options?void 0:options.debug)||!0)&&toaster.push(React.createElement(rsuite.Notification,{type:"success",header:"Command",closable:!0},React.createElement(JsonView,{data:newPayload,expanded:!0})),{placement:(null==options?void 0:options.placement)||"bottomEnd",duration:(null==options?void 0:options.duration)||2e3})},_class}())}function useStreamActions(){var streamContext=useStreamContext(),save=useSave(),cls;return new(function(){function _class(){}var _proto=_class.prototype;return _proto.play=function play(){var _window$player$stream;null==(_window$player$stream=window.player.stream)||_window$player$stream.play()},_proto.reconnect=function reconnect(){var _window$player$stream2;null==(_window$player$stream2=window.player.stream)||_window$player$stream2.reconnect()},_proto.disconnect=function disconnect(){var _window$player$stream3;null==(_window$player$stream3=window.player.stream)||_window$player$stream3.disconnect()},_proto.emitUi=function emitUi(payload,options){save.add("ui",payload,options),streamContext.isStreamActive?window.metaeditor&&window.metaeditor.emitUIInteraction(payload):console.error("Stream is not active. Can not emit UI interaction.")},_proto.emitSys=function emitSys(payload,options){save.add("sys",payload,options),streamContext.isStreamActive?window.metaeditor&&window.metaeditor.emitCommand(payload):console.error("Stream is not active. Can not emit system command.")},_proto.resetResolution=function resetResolution(){var width,height,payload={"Resolution.Width":window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,"Resolution.Height":window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight};this.emitSys(payload,{debug:!1})},_proto.switchMuted=function switchMuted(){if(this.nodeVideo){var muted=!streamContext.state.playerConfig.psConfig.startMuted;this.nodeVideo.muted=muted,streamContext.setMuted(muted)}},_createClass(_class,[{key:"nodeVideo",get:function get(){return document.getElementById("streamingVideo")}}]),_class}())}function usePreloader(){var globalContext=useGlobalContext(),streamContext=useStreamContext(),streamActions=useStreamActions(),cls;return new(function(){function _class(){}var _proto=_class.prototype;return _proto.connect=function connect(){streamActions.reconnect()},_proto.hide=function hide(){globalContext.hidePreloader()},_createClass(_class,[{key:"isWebrtcConnected",get:function get(){return streamContext.isWebrtcConnected}},{key:"webrtcErrorHeader",get:function get(){return streamContext.isWebrtcError?streamContext.state.webrtcMessage:null}},{key:"connectionHeader",get:function get(){return streamContext.state.webrtcMessage||streamContext.state.webrtcStatus}}]),_class}())}function useEventListener(element,eventName,handler){var savedHandler=React.useRef(null);React.useEffect((function(){handler&&(savedHandler.current=handler)}),[handler]),React.useEffect((function(){var isSupported;if(element&&element.addEventListener){var eventListener=function eventListener(event){return savedHandler.current(event)};return element.addEventListener(eventName,eventListener),function(){element.removeEventListener(eventName,eventListener)}}}),[eventName,element])}function useStreamEvents(){var streamContext=useStreamContext(),player="undefined"!=typeof window&&window.player?window.player:null,stream=null==player?void 0:player.stream;useEventListener(stream,"webRtcSdp",(function(){streamContext.setWebrtcStatus("connection","Connection negotiated")})),useEventListener(stream,"webRtcAutoConnect",(function(){streamContext.setWebrtcStatus("autoConnect","Auto Connecting Now")})),useEventListener(stream,"webRtcConnecting",(function(){streamContext.setWebrtcStatus("connecting","Starting connection to server, please wait")})),useEventListener(stream,"webRtcConnected",(function(){streamContext.setWebrtcStatus("connected","WebRTC connected, waiting for video")})),useEventListener(stream,"webRtcFailed",(function(){streamContext.setWebrtcStatus("failed","Unable to setup video")})),useEventListener(stream,"webRtcDisconnected",(function(_ref){var _ref$data=_ref.data,eventString=_ref$data.eventString,showActionOrErrorOnDisconnect;0==_ref$data.showActionOrErrorOnDisconnect?streamContext.setWebrtcStatus("disconnected",eventString):streamContext.setWebrtcStatus("disconnectedRestart",eventString)})),useEventListener(stream,"videoInitialized",(function(){streamContext.setStreamStatus("initialized")})),useEventListener(stream,"streamLoading",(function(){streamContext.setStreamStatus("loading","Loading Stream")})),useEventListener(stream,"playStreamError",(function(_ref2){var message=_ref2.data.message;streamContext.setStreamStatus("error",message)})),useEventListener(null==stream?void 0:stream.videoElementParent,"click",(function(){"connected"==streamContext.state.webrtcStatus&&"play"!==streamContext.state.streamStatus&&streamContext.setStreamStatus("play")})),useEventListener(stream,"playStreamRejected",(function(_ref3){var reason=_ref3.data.reason;streamContext.setStreamStatus("rejected",reason)})),useEventListener(stream,"loadFreezeFrame",(function(_ref4){var shouldShowPlayOverlay=_ref4.data.shouldShowPlayOverlay;streamContext.setFreezeFrame(shouldShowPlayOverlay)}))}function useWindowSize(){var _useState=React.useState({width:0,height:0}),windowSize=_useState[0],setWindowSize=_useState[1],width,height;return React.useEffect((function(){function handleResize(){setWindowSize({width:window.innerWidth,height:window.innerHeight});var doc=document.documentElement;doc.style.setProperty("--window-width",window.innerWidth+"px"),doc.style.setProperty("--window-height",window.innerHeight+"px")}return window.addEventListener("resize",handleResize),handleResize(),function(){return window.removeEventListener("resize",handleResize)}}),[]),{width:windowSize.width,height:windowSize.height}}function useResponseSave(){var streamContext=useStreamContext(),toaster=rsuite.useToaster(),cls;return new(function(){function _class(){}var _proto=_class.prototype;return _proto.handler=function handler(data){var event=new CustomEvent("ue_response",{detail:data});document.dispatchEvent(event)},_proto.add=function add(payload){var newPayload={date:moment.utc().format(),payload:payload},showNotification,debugMode;streamContext.addResponse(newPayload),"off"!==(debugMode=streamContext.state.playerConfig.debugMode)&&!!["on","responses"].includes(debugMode)&&toaster.push(React.createElement(rsuite.Notification,{type:"info",header:"Response",closable:!0},React.createElement(JsonView,{data:newPayload,expanded:!0})),{placement:"bottomEnd",duration:3e3})},_class}())}function useStreamResponses(){var _window3,responseSave=useResponseSave();React.useEffect((function(){var _window;return null!=(_window=window)&&_window.metaeditor&&window.metaeditor.emitResponse.addResponseEventListener("handle_responses",responseSave.handler),function(){var _window2;null!=(_window2=window)&&_window2.metaeditor&&window.metaeditor.emitResponse.removeResponseEventListener("handle_responses")}}),[null==(_window3=window)?void 0:_window3.metaeditor])}var watermark=new(function(){function _class(){}var _proto=_class.prototype;return _proto.start=function start(){clearInterval(watermarkTimer),watermarkTimer=setInterval((function(){watermark.injector()}),100)},_proto.stop=function stop(){var _this$node;clearInterval(watermarkTimer),null==(_this$node=this.node)||_this$node.remove()},_proto.injector=function injector(){if(!this.node){var dc=document.createElement("div");dc.addEventListener("mouseover",(function(){dc.style.opacity="1"})),dc.addEventListener("mouseleave",(function(){dc.style.opacity=".7"})),dc.innerText=project.name,dc.onclick=function(event){event.preventDefault(),event.stopPropagation(),window.open(project.urls.buy)},dc.setAttribute("style","\n          text-shadow: 1px 1px 1px #000000;\n          text-transform: uppercase;\n          opacity: .7 !important;\n          display: none !important;\n          visibility: visible !important;\n          position: fixed !important;\n          bottom: 0.25rem !important;\n          right: 1rem !important;\n          z-index: 999999999999999999 !important;\n          color: #fff !important;\n          font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;\n          font-size: .55rem !important;\n          line-height: 100% !important;\n          letter-spacing: 1px;\n          cursor: pointer !important;\n          transition: background-color 300ms linear;\n          user-select: none !important;\n        "),document.body.appendChild(dc)}},_createClass(_class,[{key:"node",get:function get(){var xpath="//div[text()='"+project.name+"']",matchingElement;return document.evaluate(xpath,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}}]),_class}());function useWatermark(){var globalContext=useGlobalContext(),streamContext=useStreamContext(),licenseData=globalContext.state.licenseData,configLoaded=!!streamContext.state.playerConfig;React.useEffect((function(){return function(){watermark.stop()}}),[]),React.useEffect((function(){globalContext.isLicenseActivated?watermark.stop():watermark.start()}),[licenseData]),React.useEffect((function(){configLoaded&&globalContext.checkApiKey()}),[configLoaded])}var useStyles=reactJss.createUseStyles({rootDiv:{position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:10,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",pointerEvents:"none",padding:"3rem","& > *":{pointerEvents:"all"}},webrtcError:{display:"flex",flexDirection:"column",alignItems:"center","& > h5":{textAlign:"center",marginBottom:"1rem"}},preloader:{display:"flex",flexDirection:"column",alignItems:"center","& > small":{textAlign:"center",margin:"1rem 0 .5rem",cursor:"default",opacity:.5}}}),Preloader=function Preloader(){var styles=useStyles(),preloader=usePreloader();return preloader.isWebrtcConnected?React.createElement(PlayOutlineIcon,{onClick:function onClick(event){},style:{pointerEvents:"none",color:"#fff",fontSize:"10em",cursor:"pointer"}}):React.createElement("div",{className:styles.preloader},React.createElement(SpinnerIcon,{pulse:!0,style:{color:"#fff",fontSize:"3em"}}),React.createElement("small",null,preloader.connectionHeader))},WebrtcError=function WebrtcError(){var styles=useStyles(),preloader=usePreloader();return React.createElement("div",{className:styles.webrtcError},React.createElement("h5",null,preloader.webrtcErrorHeader),React.createElement(rsuite.Button,{onClick:preloader.connect,appearance:"ghost"},"Restart"))};function PreloaderDialog(){var styles=useStyles(),globalContext=useGlobalContext(),preloader=usePreloader();return globalContext.state.showPreloader?preloader.isWebrtcConnected?null:React.createElement("div",{className:styles.rootDiv},preloader.webrtcErrorHeader?React.createElement(WebrtcError,null):React.createElement(Preloader,null)):null}var useMedia=function useMedia(){var smUp,smDown;return{up:{sm:useMediaQuery("(min-width: 768px)")},down:{sm:useMediaQuery("(max-width: 768px)")}}};function useMediaQuery(query){var getMatches=function getMatches(query){return"undefined"!=typeof window&&window.matchMedia(query).matches},_useState=React.useState(getMatches(query)),matches=_useState[0],setMatches=_useState[1];function handleChange(){setMatches(getMatches(query))}return React.useEffect((function(){var matchMedia=window.matchMedia(query);return handleChange(),matchMedia.addListener?matchMedia.addListener(handleChange):matchMedia.addEventListener("change",handleChange),function(){matchMedia.removeListener?matchMedia.removeListener(handleChange):matchMedia.removeEventListener("change",handleChange)}}),[query]),matches}function Appbar(){var globalContext=useGlobalContext(),media=useMedia(),streamActions=useStreamActions(),isLicenseValid=globalContext.isLicenseValid,toolsMenu=[{title:"Restart stream",onClick:function onClick(){streamActions.reconnect()}},{title:"Close stream",onClick:function onClick(){streamActions.disconnect()}},{title:"Reset resolution",onClick:function onClick(){streamActions.resetResolution()}}],helpMenu=(res=[{title:"Online Player",href:project.urls.onlinePlayer},{title:"Signaling Server",href:project.urls.signalingServer},{title:"Documentation",href:project.urls.docs},{title:"Support",href:project.urls.support}],media.down.sm&&!isLicenseValid&&(res=[{title:project.name+" Pro",href:project.urls.buy}].concat(res)),res),res;return React.createElement(rsuite.Navbar,{appearance:"subtle"},React.createElement(rsuite.Navbar.Brand,{as:"a",href:project.urls.main,target:"_blank"},project.name," ",isLicenseValid&&"Pro"),React.createElement(rsuite.Nav,{onSelect:function onSelect(){},activeKey:void 0},React.createElement(rsuite.Nav.Menu,{title:"Tools"},toolsMenu.map((function(item,index){return React.createElement(rsuite.Nav.Item,{key:index,onClick:item.onClick},item.title)}))),React.createElement(rsuite.Nav.Menu,{title:"Help"},helpMenu.map((function(item,index){return React.createElement(rsuite.Nav.Item,{key:index,as:"a",href:item.href,target:"_blank"},item.title)})))),media.up.sm&&!isLicenseValid&&React.createElement(rsuite.Nav,{pullRight:!0},React.createElement(rsuite.Nav.Item,{as:"a",href:project.urls.buy,target:"_blank"},React.createElement(rsuite.Button,{color:"green",appearance:"primary",startIcon:React.createElement(CheckRoundIcon,null)},"Buy Pro"))))}var _excluded=["title","children","contentPadding","onClose"],CustomDrawer=React.forwardRef((function(_ref,ref){var title=_ref.title,children=_ref.children,contentPadding=_ref.contentPadding,_onClose=_ref.onClose,props=_objectWithoutPropertiesLoose(_ref,_excluded),media=useMedia(),_useState=React.useState(!1),open=_useState[0],setOpen=_useState[1];React.useImperativeHandle(ref,(function(){return{open:function open(){setOpen(!0)},close:function close(){setOpen(!1)}}}));var drawerSize=media.up.sm?props.size||"xs":"full";return React.createElement(React.Fragment,null,React.createElement(rsuite.Drawer,Object.assign({},props,{size:drawerSize,open:open,onClose:function onClose(){setOpen(!1),_onClose&&_onClose()}}),React.createElement(rsuite.Drawer.Header,null,React.createElement(rsuite.Drawer.Title,null,title)),React.createElement(rsuite.Drawer.Body,{style:{padding:contentPadding}},open&&children)))}));function DrawerContainer(){var streamContext=useStreamContext(),streamActions=useStreamActions(),responseSave=useResponseSave();return React.createElement(React.Fragment,null,React.createElement("div",null,React.createElement("h6",null,"Current config"),React.createElement(JsonView,{data:streamContext.state,expanded:!0}),React.createElement(rsuite.Divider,null),React.createElement("h6",null,"Commands history"),React.createElement(JsonView,{data:streamContext.commandsList}),React.createElement(rsuite.Divider,null),React.createElement("h6",null,"Responses history"),React.createElement(JsonView,{data:streamContext.responsesList}),React.createElement(rsuite.Divider,null),React.createElement(rsuite.Stack,{direction:"column",spacing:5,alignItems:"flex-start"},React.createElement(rsuite.Button,{onClick:function onClick(){return streamActions.resetResolution()}},"Reset resolution"),React.createElement(rsuite.Button,{onClick:function onClick(){responseSave.handler({demo:!0})}},"Test response"))))}var DrawerInfo=React.forwardRef((function(props,ref){var refDrawer=React.useRef(null);return React.useImperativeHandle(ref,(function(){return{open:function open(){null==refDrawer||refDrawer.current.open()},close:function close(){null==refDrawer||refDrawer.current.close()}}})),React.createElement(CustomDrawer,{backdrop:!0,contentPadding:20,placement:"right",title:"Tools Panel",ref:refDrawer},React.createElement("div",{style:{height:"100%"}},React.createElement(DrawerContainer,null)))}));function UiButton(){var refDrawerInfo=React.useRef(null);return React.createElement(React.Fragment,null,React.createElement(DrawerInfo,{ref:refDrawerInfo}),React.createElement("button",{onClick:function onClick(){return refDrawerInfo.current.open()}},React.createElement(ToolsIcon,{style:{fontSize:24,lineHeight:0}})))}var useStyles$1=reactJss.createUseStyles({message:{cursor:"pointer",backgroundColor:"var(--rs-message-warning-bg)",color:"var(--rs-message-warning-text)",padding:".3rem 1rem",transition:"background-color .1s linear","&:hover":{backgroundColor:"var(--rs-orange-800)"}}});function PackageUpdate(){var globalContext=useGlobalContext(),styles=useStyles$1(),pkg=globalContext.state.packageVersion,needUpdate;return pkg.needUpdate?React.createElement("div",{className:styles.message,onClick:function onClick(){window.open(project.package.npmUrl)}},"Update ",project.name," from version ",pkg.current," to ",pkg.latest):null}var useStyles$2=reactJss.createUseStyles({appbar:{position:"fixed",top:0,right:0,left:0,zIndex:20,backgroundColor:"#000"}});function Toolbar(_ref){var show=_ref.show,styles=useStyles$2(),_useResizeObserver=useResizeObserver({box:"border-box"}),ref=_useResizeObserver.ref,height=_useResizeObserver.height;React.useEffect((function(){if(height){var doc;document.documentElement.style.setProperty("--appbar-height",height+"px");var el=document.getElementById("controls"),controlsHeight=el.clientHeight;if(el){el.style.top=height+"px";var elConnection=document.getElementById("connection");elConnection&&(elConnection.style.top=height+controlsHeight+20+"px",elConnection.style.bottom="auto",elConnection.style.left="2%")}}}),[height]);var nodeUiFeatures="undefined"!=typeof document&&document.getElementById("uiFeatures"),nodePlayerUI="undefined"!=typeof document&&document.getElementById("playerUI"),nodeControls="undefined"!=typeof document&&document.getElementById("controls");return React.useEffect((function(){nodeUiFeatures&&(nodeUiFeatures.style.visibility=show?"visible":"hidden")}),[show,nodeUiFeatures]),show&&nodePlayerUI?React.createElement(React.Fragment,null,React.createElement(reactPortal.Portal,{node:nodePlayerUI},React.createElement("div",{className:styles.appbar,ref:ref},React.createElement(PackageUpdate,null),React.createElement(Appbar,null))),React.createElement(reactPortal.Portal,{node:nodeControls},React.createElement(UiButton,null))):null}var useStyles$3=reactJss.createUseStyles({containerRoot:{position:"fixed",top:0,right:0,left:0,bottom:0,height:"var(--window-height)",padding:0,paddingTop:0,pointerEvents:"none",display:"flex",flexDirection:"column",justifyContent:"flex-end","& > div":{"& > *":{pointerEvents:"all"}}}});function Container(_ref){var children=_ref.children,styles=useStyles$3();return React.createElement("div",{className:styles.containerRoot},React.createElement("div",null,children))}var _excluded$1=["children"],PixelStreamingApplicationStyles=new metaeditor4Ui.PixelStreamingApplicationStyle;PixelStreamingApplicationStyles.applyStyleSheet();var useStyles$4=reactJss.createUseStyles({"@global":{body:{width:"100vw",height:"var(--window-height)",minHeight:"-webkit-fill-available",overflow:"hidden"},"#playOverlay":{display:"none"},"#infoOverlay":{display:"none"},"#disconnectOverlay":{display:"none"},"#errorOverlay":{display:"none"},"#uiFeatures":{visibility:"hidden"},'[data-click="true"]':{pointerEvents:"all"},'[data-click="false"]':{pointerEvents:"none"}},rootDiv:{zIndex:0,position:"fixed",top:0,right:0,left:0,bottom:0,width:"100vw",height:"var(--window-height)",overflow:"hidden",userSelect:"none"}}),PlayerComponent=React.forwardRef((function(_ref,ref){var children=_ref.children,props=_objectWithoutPropertiesLoose(_ref,_excluded$1),showToolbar=props.showToolbar,psHost=props.psHost,globalContext=useGlobalContext(),streamContext=useStreamContext(),styles=useStyles$4(),refRoot=React.useRef(null),_React$useState=React.useState(!1),isReady=_React$useState[0],setIsReady=_React$useState[1];useWindowSize(),useStreamEvents(),useStreamResponses(),useWatermark(),React.useEffect((function(){metaeditor4Ue.Logger.SetLoggerVerbosity(0),isReady||(setIsReady(!0),props.showToolbar&&globalContext.checkVersion(),init())}),[]);var init=function init(){streamContext.updateConfig(props);var initialSettings={AutoPlayVideo:props.psConfig.autoPlay,AutoConnect:!0,ss:psHost,StartVideoMuted:!0,HoveringMouse:!0,FakeMouseWithTouches:!0,MatchViewportRes:!0},config=new metaeditor4Ue.Config({useUrlParams:!0,initialSettings:initialSettings}),stream=new metaeditor4Ue.PixelStreaming(config),application=new metaeditor4Ui.Application({stream:stream});refRoot.current&&!refRoot.current.textContent&&(streamContext.setRefStream(application),window.player=application,refRoot.current.appendChild(application.rootElement),"function"==typeof props.onLoad&&props.onLoad())};return React.useImperativeHandle(ref,(function(){return{init:init}})),React.createElement("div",null,React.createElement(PreloaderDialog,null),React.createElement(Toolbar,{show:showToolbar}),React.createElement("div",{ref:refRoot,className:styles.rootDiv}),children?React.createElement(Container,null,children):"")})),RootComponent=React.forwardRef((function(props,ref){var _React$useState=React.useState(!1),mounted=_React$useState[0],setMounted=_React$useState[1];return React.useEffect((function(){setMounted(!0)}),[]),mounted?React.createElement(rsuite.CustomProvider,{theme:"dark"},React.createElement(PlayerComponent,Object.assign({},props,{ref:ref}))):null})),Context$2={global:useGlobalContext,stream:useStreamContext},Hooks={actions:useStreamActions,events:useStreamEvents,listener:useEventListener,preloader:usePreloader};exports.Context=Context$2,exports.Hooks=Hooks,exports.MetaEditor=RootComponent,exports.MetaProvider=ContextProvider;